#!/usr/bin/env cwl-runner

cwlVersion: "cwl:draft-3"

class: CommandLineTool

requirements:
  - $import: envvar-global.cwl
  - class: InlineJavascriptRequirement
  - class: ShellCommandRequirement
  - class: MultipleInputFeatureRequirement
  - class: DockerRequirement
    dockerPull: registry.gitlab.com/uc-cdis/genomel-secondary-analysis:0.1a

inputs:
  - id: java_opts
    type: string
    default: "-Xmx8g"
    description: |
      "JVM arguments should be a quoted, space separated list (e.g. \"-Xmx8g -Xmx16g -Xms128m -Xmx512m\")"
    inputBinding:
      position: 1
      shellQuote: false
  - id: gatk_jar_path
    type: string
    default: "/home/ubuntu/tools/GenomeAnalysisTK.jar"
    inputBinding:
      position: 2
      prefix: "-jar"
  - id: gatk_tool
    type: string
    default: "LeftAlignIndels"
    inputBinding:
      position: 3
      prefix: "-T"
  - id: input_bam_path
    type: File
    inputBinding:
      position: 4
      prefix: "-I"
    secondaryFiles:
      - "^.bai"
  - id: reference_fasta_path
    type: File
    inputBinding:
      position: 5
      prefix: "-R"
    secondaryFiles:
      - "^.dict"
      - ".fai"

outputs:
  - id: left_aligned_bam
    type: File
    outputBinding:
      glob: $(inputs.input_bam_path.path.slice(0,-4) + '.left_aligned.bam')
    secondaryFiles:
      - "^.bai"

baseCommand: java
arguments:
  - valueFrom: $(inputs.input_bam_path.path.slice(0,-4) + '.left_aligned.bam')
    position: 6
    prefix: "-o"


description: |
    This tool left-aligns any indels within read cigars in order to standardize representation when there are multiple valid representations possible (i.e. where the same indel can be placed at multiple positions and still represent the same haplotype). The standard convention is to place an indel at the left-most position possible, but this is not always followed, so this tool can be used to correct the representation of indels.
